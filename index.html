<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FloraOS - Lab Management System</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå±</text></svg>">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">üå±</div>
      <h1 class="sidebar-title">FloraOS</h1>
    </div>
    <nav>
      <ul class="nav-menu">
        <li class="nav-item">
          <a class="nav-link active" data-module="dashboard">
            <span class="nav-icon">üìä</span>
            <span class="nav-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="lab">
            <span class="nav-icon">üî¨</span>
            <span class="nav-text">Lab LIMS</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="analytics">
            <span class="nav-icon">üìà</span>
            <span class="nav-text">Analytics</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="quality">
            <span class="nav-icon">‚úì</span>
            <span class="nav-text">Quality Control</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="equipment">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-text">Equipment</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="business">
            <span class="nav-icon">üíº</span>
            <span class="nav-text">Business ERP</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="shipments">
            <span class="nav-icon">üì¶</span>
            <span class="nav-text">Shipment Tracking</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="environment">
            <span class="nav-icon">üå°Ô∏è</span>
            <span class="nav-text">Environment</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="productivity">
            <span class="nav-icon">‚úÖ</span>
            <span class="nav-text">Productivity</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="tools">
            <span class="nav-icon">üîß</span>
            <span class="nav-text">Custom Tools</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-module="settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-text">Settings</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Dashboard Module -->
    <div id="dashboard" class="module active">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Command Center</h2>
      
      <div class="bento-grid">
        <!-- Net Profit Card -->
        <div class="bento-card span-2">
          <div class="card-header">
            <span class="card-title">Net Profit</span>
          </div>
          <div class="card-value" id="netProfitValue">$0</div>
          <div class="card-trend" id="netProfitTrend">
            <span>‚Üë 0%</span>
            <span class="text-secondary">vs last month</span>
          </div>
        </div>

        <!-- Active Batches -->
        <div class="bento-card">
          <div class="card-header">
            <span class="card-title">Active Batches</span>
          </div>
          <div class="card-value" id="activeBatchesValue">0</div>
          <button class="btn btn-secondary" style="width: 100%; margin-top: 16px;" onclick="switchModule('lab')">View All</button>
        </div>

        <!-- Contamination Rate -->
        <div class="bento-card">
          <div class="card-header">
            <span class="card-title">Contamination Rate</span>
          </div>
          <div class="card-value" id="contaminationValue">0%</div>
          <div id="contaminationBadge"></div>
        </div>

        <!-- Urgent Tasks -->
        <div class="bento-card span-2">
          <div class="card-header">
            <span class="card-title">Urgent Tasks</span>
          </div>
          <ul class="urgent-list" id="urgentTasksList"></ul>
        </div>

        <!-- Pending Orders -->
        <div class="bento-card">
          <div class="card-header">
            <span class="card-title">Pending Orders</span>
          </div>
          <div class="card-value" id="pendingOrdersValue">0</div>
        </div>

        <!-- Active Shipments -->
        <div class="bento-card">
          <div class="card-header">
            <span class="card-title">Active Shipments</span>
          </div>
          <div class="card-value" id="activeShipmentsValue">0</div>
          <button class="btn btn-secondary" style="width: 100%; margin-top: 16px;" onclick="switchModule('shipments')">Track All</button>
        </div>
      </div>
    </div>
    <!-- Lab LIMS Module -->
    <div id="lab" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Laboratory Information Management</h2>
      
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
        <button class="btn btn-primary" onclick="showLabSection('batches')">Batches</button>
        <button class="btn btn-primary" onclick="showLabSection('media')">Media Recipes</button>
        <button class="btn btn-primary" onclick="showLabSection('chemicals')">Chemicals</button>
        <button class="btn btn-primary" onclick="showLabSection('notebook')">Lab Notebook</button>
      </div>

      <!-- Batches Section -->
      <div id="batchesSection">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Batch Management</h3>
            <div class="table-controls">
              <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" class="search-input" placeholder="Search batches..." id="batchSearch">
              </div>
              <button class="btn btn-primary" onclick="openModal('addBatchModal')">+ New Batch</button>
            </div>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th onclick="sortTable('batches', 'id')">Batch ID</th>
                  <th onclick="sortTable('batches', 'species')">Species</th>
                  <th onclick="sortTable('batches', 'clone')">Clone</th>
                  <th onclick="sortTable('batches', 'stage')">Stage</th>
                  <th>Explant Type</th>
                  <th onclick="sortTable('batches', 'dateInitiated')">Initiated</th>
                  <th onclick="sortTable('batches', 'lastSubcultured')">Last Subcultured</th>
                  <th onclick="sortTable('batches', 'location')">Location</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="batchesTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Media Recipes Section -->
      <div id="mediaSection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Media Recipe Library</h3>
            <button class="btn btn-primary" onclick="openModal('addMediaRecipeModal')">+ New Recipe</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Recipe ID</th>
                  <th>Name</th>
                  <th>Base</th>
                  <th>Stage</th>
                  <th>Carbon Source</th>
                  <th>pH</th>
                  <th>PGRs</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="mediaRecipesTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Chemicals Section -->
      <div id="chemicalsSection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Chemical & Stock Solution Management</h3>
            <button class="btn btn-primary" onclick="openModal('addChemicalModal')">+ Add Chemical</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Chemical Name</th>
                  <th>Category</th>
                  <th>Container Opened</th>
                  <th>Cost</th>
                  <th>Source</th>
                  <th>Storage Location</th>
                  <th>Expiry</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="chemicalsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Lab Notebook Section -->
      <div id="notebookSection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Digital Laboratory Notebook (IP Protected)</h3>
            <button class="btn btn-primary" onclick="openModal('addNotebookEntryModal')">+ New Entry</button>
          </div>
          <div id="notebookEntries" style="padding: 24px;"></div>
        </div>
      </div>
    </div>
    <!-- Analytics Module -->
    <div id="analytics" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Analytics & Insights</h2>
      
      <div class="bento-grid" style="margin-bottom: 32px;">
        <div class="bento-card span-2">
          <div class="card-header">
            <h3 class="card-title">Expense Breakdown by Category</h3>
          </div>
          <div id="expenseBreakdownChart" style="height: 300px;"></div>
        </div>
        
        <div class="bento-card span-2">
          <div class="card-header">
            <h3 class="card-title">Monthly Revenue vs Expenses</h3>
          </div>
          <div id="revenueExpenseChart" style="height: 300px;"></div>
        </div>

        <div class="bento-card span-2">
          <div class="card-header">
            <h3 class="card-title">Labor Cost Analysis</h3>
          </div>
          <div id="laborCostChart" style="height: 300px;"></div>
          <div style="margin-top: 16px; padding: 16px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
            <p class="text-secondary" style="font-size: 14px;">
              <strong>Labor represents:</strong> <span id="laborPercentage">0%</span> of operating costs<br>
              <strong>Average cost per batch:</strong> $<span id="costPerBatch">0</span>
            </p>
          </div>
        </div>

        <div class="bento-card span-2">
          <div class="card-header">
            <h3 class="card-title">Contamination Rate Trend</h3>
          </div>
          <div id="contaminationTrendChart" style="height: 300px;"></div>
        </div>
      </div>

      <div class="data-table">
        <div class="table-header">
          <h3 class="table-title">Production Efficiency Metrics</h3>
        </div>
        <div style="padding: 24px;">
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px;">
              <p class="text-secondary" style="font-size: 13px; margin-bottom: 8px;">BATCHES THIS MONTH</p>
              <p style="font-size: 32px; font-weight: 700;" id="batchesThisMonth">0</p>
            </div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px;">
              <p class="text-secondary" style="font-size: 13px; margin-bottom: 8px;">SUCCESS RATE</p>
              <p style="font-size: 32px; font-weight: 700; color: var(--accent-green);" id="successRate">0%</p>
            </div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px;">
              <p class="text-secondary" style="font-size: 13px; margin-bottom: 8px;">BURN RATE</p>
              <p style="font-size: 32px; font-weight: 700; color: var(--accent-orange);" id="burnRate">$0</p>
              <p class="text-secondary" style="font-size: 12px;">per month</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quality Control Module -->
    <div id="quality" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Quality Control & Diagnostics</h2>
      
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
        <button class="btn btn-primary" onclick="showQualitySection('contamination')">Contamination</button>
        <button class="btn btn-primary" onclick="showQualitySection('disorders')">Disorders</button>
        <button class="btn btn-primary" onclick="showQualitySection('fidelity')">Genetic Fidelity</button>
      </div>

      <!-- Contamination Section -->
      <div id="contaminationSection">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Contamination Incident Log</h3>
            <button class="btn btn-primary" onclick="openModal('addContaminationModal')">+ Log Incident</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Batch ID</th>
                  <th>Type</th>
                  <th>Description</th>
                  <th>Suspected Cause</th>
                  <th>Action Taken</th>
                  <th>Photo</th>
                </tr>
              </thead>
              <tbody id="contaminationTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Disorders Section -->
      <div id="disordersSection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Physiological Disorder Diagnostics</h3>
            <button class="btn btn-primary" onclick="openModal('addDisorderModal')">+ Log Disorder</button>
          </div>
          
          <div style="padding: 24px; margin-bottom: 24px; background: var(--glass-bg); border-radius: 20px; border: 1px solid var(--border-glass);">
            <h4 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">Common Disorders & Troubleshooting</h4>
            <div style="display: grid; gap: 16px;">
              <details style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 12px;">
                <summary style="cursor: pointer; font-weight: 600; margin-bottom: 8px;">Hyperhydricity (Vitrification)</summary>
                <p class="text-secondary" style="font-size: 14px; margin-top: 8px;">
                  <strong>Symptoms:</strong> Glassy, translucent appearance; excessive water content; fragile tissue<br>
                  <strong>Causes:</strong> High humidity in vessel, excessive cytokinins, poor ventilation<br>
                  <strong>Solutions:</strong> Reduce cytokinin concentration, increase agar concentration, improve vessel ventilation
                </p>
              </details>
              <details style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 12px;">
                <summary style="cursor: pointer; font-weight: 600; margin-bottom: 8px;">Phenolic Browning</summary>
                <p class="text-secondary" style="font-size: 14px; margin-top: 8px;">
                  <strong>Symptoms:</strong> Brown discoloration of tissue and media; tissue necrosis<br>
                  <strong>Causes:</strong> Oxidation of phenolic compounds, tissue damage, stress<br>
                  <strong>Solutions:</strong> Add activated charcoal (0.5-2 g/L), use antioxidants (ascorbic acid, citric acid), frequent subculture
                </p>
              </details>
              <details style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 12px;">
                <summary style="cursor: pointer; font-weight: 600; margin-bottom: 8px;">Etiolation</summary>
                <p class="text-secondary" style="font-size: 14px; margin-top: 8px;">
                  <strong>Symptoms:</strong> Pale, elongated shoots; weak stems; poor chlorophyll development<br>
                  <strong>Causes:</strong> Insufficient light intensity, improper light spectrum<br>
                  <strong>Solutions:</strong> Increase light intensity to 3000-5000 lux, check photoperiod, use appropriate light spectrum
                </p>
              </details>
            </div>
          </div>

          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Batch ID</th>
                  <th>Disorder Type</th>
                  <th>Severity</th>
                  <th>Notes</th>
                  <th>Resolution</th>
                </tr>
              </thead>
              <tbody id="disordersTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Genetic Fidelity Section -->
      <div id="fidelitySection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Somaclonal Variation & Genetic Fidelity</h3>
            <button class="btn btn-primary" onclick="openModal('addFidelityModal')">+ Log Assessment</button>
          </div>
          
          <div style="padding: 24px; margin-bottom: 24px;">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
              <div style="background: rgba(48, 209, 88, 0.1); padding: 20px; border-radius: 12px; border: 1px solid var(--accent-green);">
                <p class="text-secondary" style="font-size: 13px; margin-bottom: 8px;">GENETIC FIDELITY RATE</p>
                <p style="font-size: 32px; font-weight: 700; color: var(--accent-green);" id="fidelityRate">100%</p>
                <p class="text-secondary" style="font-size: 12px; margin-top: 4px;">Based on verified clones</p>
              </div>
              <div style="background: rgba(255, 159, 10, 0.1); padding: 20px; border-radius: 12px; border: 1px solid var(--accent-orange);">
                <p class="text-secondary" style="font-size: 13px; margin-bottom: 8px;">VARIATIONS DETECTED</p>
                <p style="font-size: 32px; font-weight: 700; color: var(--accent-orange);" id="variationsCount">0</p>
                <p class="text-secondary" style="font-size: 12px; margin-top: 4px;">Across all generations</p>
              </div>
            </div>
          </div>

          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Batch ID</th>
                  <th>Generation</th>
                  <th>Verification Method</th>
                  <th>Observation</th>
                  <th>Fidelity Status</th>
                  <th>Decision</th>
                </tr>
              </thead>
              <tbody id="fidelityTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Equipment Module -->
    <div id="equipment" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Equipment & Facility Management</h2>
      
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
        <button class="btn btn-primary" onclick="showEquipmentSection('inventory')">Equipment Inventory</button>
        <button class="btn btn-primary" onclick="showEquipmentSection('autoclave')">Autoclave Log</button>
        <button class="btn btn-primary" onclick="showEquipmentSection('sanitation')">Sanitation</button>
      </div>

      <!-- Equipment Inventory -->
      <div id="equipmentInventorySection">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Equipment Inventory</h3>
            <button class="btn btn-primary" onclick="openModal('addEquipmentModal')">+ Add Equipment</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Equipment ID</th>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Location</th>
                  <th>Last Maintenance</th>
                  <th>Next Due</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="equipmentTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Autoclave Log -->
      <div id="autoclaveSection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Autoclave Sterilization Log</h3>
            <button class="btn btn-primary" onclick="openModal('addAutoclaveModal')">+ Log Cycle</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Date/Time</th>
                  <th>Duration (min)</th>
                  <th>Target Temp (¬∞C)</th>
                  <th>Actual Temp (¬∞C)</th>
                  <th>Target Pressure (psi)</th>
                  <th>Actual Pressure (psi)</th>
                  <th>Load Description</th>
                  <th>Operator</th>
                  <th>Result</th>
                </tr>
              </thead>
              <tbody id="autoclaveTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Sanitation Log -->
      <div id="sanitationSection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Asepsis & Sanitation Monitoring</h3>
            <button class="btn btn-primary" onclick="openModal('addSanitationModal')">+ Log Check</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Area</th>
                  <th>Air Quality</th>
                  <th>Particulate Count</th>
                  <th>Surface Sterility</th>
                  <th>Notes</th>
                  <th>Pass/Fail</th>
                </tr>
              </thead>
              <tbody id="sanitationTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Environmental Controls -->
      <div class="data-table" style="margin-top: 32px;">
        <div class="table-header">
          <h3 class="table-title">Culture Room Environmental Settings</h3>
          <button class="btn btn-success" onclick="saveEnvironmentalConfig()">üíæ Save Configuration</button>
        </div>
        <div style="padding: 24px;">
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
            <div class="form-group">
              <label class="form-label">Light Spectral Quality</label>
              <select class="form-select" id="lightSpectralQuality">
                <option value="Cool White Fluorescent">Cool White Fluorescent</option>
                <option value="Gro-Lux">Gro-Lux</option>
                <option value="LED White">LED White</option>
                <option value="LED Red-Blue">LED Red-Blue</option>
                <option value="LED Full Spectrum">LED Full Spectrum</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Light Intensity</label>
              <div style="display: flex; gap: 8px;">
                <input type="number" class="form-input" id="lightIntensity" value="3000" style="flex: 1;">
                <select class="form-select" id="lightIntensityUnit" style="width: 120px;">
                  <option value="lux">lux</option>
                  <option value="¬µmol m‚Åª¬≤ s‚Åª¬π">¬µmol m‚Åª¬≤ s‚Åª¬π</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Photoperiod (Light:Dark hours)</label>
              <input type="text" class="form-input" id="photoperiod" value="16:8" placeholder="16:8">
            </div>
            <div class="form-group">
              <label class="form-label">Light Type</label>
              <select class="form-select" id="lightType">
                <option value="LED">LED</option>
                <option value="Fluorescent">Fluorescent</option>
                <option value="Incandescent">Incandescent</option>
                <option value="Natural">Natural Sunlight</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Business ERP Module -->
    <div id="business" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Business Operations</h2>
      
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 24px;">
        <button class="btn btn-primary" onclick="showBusinessSection('inventory')">Inventory</button>
        <button class="btn btn-primary" onclick="showBusinessSection('finance')">Finance</button>
        <button class="btn btn-primary" onclick="showBusinessSection('orders')">Orders & CRM</button>
      </div>

      <!-- Inventory Section -->
      <div id="inventorySection">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Inventory Management</h3>
            <button class="btn btn-primary" onclick="openModal('addInventoryModal')">+ Add Item</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Item Name</th>
                  <th>Category</th>
                  <th>Current Stock</th>
                  <th>Reorder Level</th>
                  <th>Cost/Unit</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="inventoryTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Finance Section -->
      <div id="financeSection" style="display: none;">
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 24px;">
          <button class="btn btn-primary" onclick="openModal('addIncomeModal')">+ Add Income</button>
          <button class="btn btn-primary" onclick="openModal('addExpenseModal')">+ Add Expense</button>
        </div>

        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Recent Transactions</h3>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Category</th>
                  <th>Description</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody id="transactionsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Orders Section -->
      <div id="ordersSection" style="display: none;">
        <div class="data-table">
          <div class="table-header">
            <h3 class="table-title">Order Pipeline</h3>
            <button class="btn btn-primary" onclick="openModal('addOrderModal')">+ New Order</button>
          </div>
          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>Order #</th>
                  <th>Customer</th>
                  <th>Items</th>
                  <th>Total Value</th>
                  <th>Status</th>
                  <th>Tracking</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="ordersTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Shipment Tracking Module -->
    <div id="shipments" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Shipment Tracking</h2>
      
      <div class="data-table">
        <div class="table-header">
          <h3 class="table-title">Active Shipments</h3>
          <div class="table-controls">
            <button class="btn btn-secondary" onclick="refreshAllShipments()">üîÑ Refresh All</button>
            <button class="btn btn-primary" onclick="openModal('addShipmentModal')">+ Track Shipment</button>
          </div>
        </div>
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Order #</th>
                <th>Customer</th>
                <th>Tracking Number</th>
                <th>Carrier</th>
                <th>Status</th>
                <th>Last Update</th>
                <th>Est. Delivery</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="shipmentsTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Environment Module -->
    <div id="environment" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Environment Monitor</h2>
      
      <button class="btn btn-primary" onclick="openModal('addEnvLogModal')">+ Log Today's Data</button>

      <div class="chart-container">
        <div class="chart-header">
          <h3 style="font-size: 18px; font-weight: 600;">7-Day Temperature & Humidity</h3>
        </div>
        <div id="envChart" style="height: 200px; display: flex; align-items: flex-end; gap: 8px;"></div>
      </div>

      <div class="data-table">
        <div class="table-header">
          <h3 class="table-title">Environmental Logs</h3>
        </div>
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Temp Morning (¬∞C)</th>
                <th>Temp Evening (¬∞C)</th>
                <th>Humidity (%)</th>
                <th>Photoperiod</th>
                <th>Light Intensity</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="envLogsTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Productivity Module -->
    <div id="productivity" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Productivity Suite</h2>
      
      <button class="btn btn-primary" onclick="openModal('addTaskModal')">+ New Task</button>

      <div class="kanban-board">
        <div class="kanban-column">
          <div class="kanban-header">
            <h3 class="kanban-title">To Do</h3>
            <span class="kanban-count" id="todoCount">0</span>
          </div>
          <div id="todoTasks"></div>
        </div>

        <div class="kanban-column">
          <div class="kanban-header">
            <h3 class="kanban-title">In Progress</h3>
            <span class="kanban-count" id="inProgressCount">0</span>
          </div>
          <div id="inProgressTasks"></div>
        </div>

        <div class="kanban-column">
          <div class="kanban-header">
            <h3 class="kanban-title">Done</h3>
            <span class="kanban-count" id="doneCount">0</span>
          </div>
          <div id="doneTasks"></div>
        </div>
      </div>
    </div>

    <!-- Custom Tools Module -->
    <div id="tools" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">Custom Tools Integration</h2>
      
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 24px;">
        <button class="btn btn-primary" onclick="showCustomTool('toolA')">Tool A</button>
        <button class="btn btn-primary" onclick="showCustomTool('toolB')">Tool B</button>
        <button class="btn btn-primary" onclick="showCustomTool('toolC')">Tool C</button>
      </div>

      <div id="customToolA" class="custom-tool-container" style="display: none;">
        <h3 style="font-size: 22px; font-weight: 600; margin-bottom: 16px;">Custom Tool A</h3>
        <div class="tool-instructions">
          Paste your external HTML tool code here. The tool will be isolated with CSS scoping to prevent style conflicts.
        </div>
        <!-- USER PASTE ZONE A -->
      </div>

      <div id="customToolB" class="custom-tool-container" style="display: none;">
        <h3 style="font-size: 22px; font-weight: 600; margin-bottom: 16px;">Custom Tool B</h3>
        <div class="tool-instructions">
          Paste your external HTML tool code here. The tool will be isolated with CSS scoping to prevent style conflicts.
        </div>
        <!-- USER PASTE ZONE B -->
      </div>

      <div id="customToolC" class="custom-tool-container" style="display: none;">
        <h3 style="font-size: 22px; font-weight: 600; margin-bottom: 16px;">Custom Tool C</h3>
        <div class="tool-instructions">
          Paste your external HTML tool code here. The tool will be isolated with CSS scoping to prevent style conflicts.
        </div>
        <!-- USER PASTE ZONE C -->
      </div>
    </div>

    <!-- Settings Module -->
    <div id="settings" class="module">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px;">System Settings</h2>
      
      <div class="data-table">
        <div class="table-header">
          <h3 class="table-title">Global Configuration</h3>
          <button class="btn btn-success" onclick="saveSettings()">üíæ Save Settings</button>
        </div>
        <div style="padding: 24px;">
          <div class="form-group">
            <label class="form-label">Default Subculture Cycle (days)</label>
            <input type="number" class="form-input" id="settingSubcultureDays" value="30">
          </div>

          <div class="form-group">
            <label class="form-label">Company Name</label>
            <input type="text" class="form-input" id="settingCompanyName" value="FloraLab">
          </div>

          <div class="form-group">
            <label class="form-label">Company Email</label>
            <input type="email" class="form-input" id="settingCompanyEmail" value="info@floralab.com">
          </div>

          <div class="form-group">
            <label class="form-label">Ship24 API Key</label>
            <input type="text" class="form-input" id="settingApiKey" value="apik_MDr4Plo16OfVS3q2Bq3s5hvo51ELUA">
          </div>

          <div class="form-group">
            <label class="form-label">Shipment Refresh Interval (minutes)</label>
            <input type="number" class="form-input" id="settingRefreshInterval" value="30">
          </div>

          <div class="form-group">
            <label class="form-label">Enable Shipment Notifications</label>
            <select class="form-select" id="settingNotifications">
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>

          <hr style="border: none; border-top: 1px solid var(--border-glass); margin: 32px 0;">

          <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">Data Management</h3>
          
          <div style="display: flex; gap: 16px;">
            <button class="btn btn-primary" onclick="exportData()">üì• Export Backup</button>
            <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Import Backup</button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
            <button class="btn btn-danger" onclick="resetApp()">üóëÔ∏è Reset All Data</button>
          </div>

          <div style="margin-top: 24px; padding: 16px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
            <p class="text-secondary" style="font-size: 14px;">
              Database Size: <strong id="dbSize">0 KB</strong><br>
              Total Batches: <strong id="totalBatches">0</strong><br>
              Total Orders: <strong id="totalOrders">0</strong><br>
              Total Shipments: <strong id="totalShipments">0</strong>
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>
  <!-- Modals -->
  <!-- Add Batch Modal -->
  <div id="addBatchModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">New Batch</h3>
        <button class="modal-close" onclick="closeModal('addBatchModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addBatchForm" onsubmit="addBatch(event)">
          <div class="form-group">
            <label class="form-label">Species</label>
            <input type="text" class="form-input" name="species" required>
          </div>
          <div class="form-group">
            <label class="form-label">Clone Name</label>
            <input type="text" class="form-input" name="clone" required>
          </div>
          <div class="form-group">
            <label class="form-label">Stage</label>
            <select class="form-select" name="stage" required>
              <option value="I">Stage I - Establishment</option>
              <option value="II">Stage II - Multiplication</option>
              <option value="III">Stage III - Rooting</option>
              <option value="IV">Stage IV - Acclimatization</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Media Recipe</label>
            <input type="text" class="form-input" name="mediaRecipe" value="MS-001">
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" name="location" placeholder="Shelf A-3" required>
          </div>
          <div class="form-group">
            <label class="form-label">Parent Batch ID (optional)</label>
            <input type="text" class="form-input" name="parentBatchID">
          </div>
          <div class="form-group">
            <label class="form-label">Explant Type</label>
            <select class="form-select" name="explantType" required>
              <option value="shoot tip">Shoot Tip</option>
              <option value="node">Node</option>
              <option value="leaf">Leaf</option>
              <option value="root">Root</option>
              <option value="meristem">Meristem</option>
              <option value="embryo">Embryo</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Genotype/Cultivar</label>
            <input type="text" class="form-input" name="genotype">
          </div>
          <div class="form-group">
            <label class="form-label">Physiological Status</label>
            <select class="form-select" name="physiologicalStatus">
              <option value="juvenile">Juvenile</option>
              <option value="mature">Mature</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Collection Season</label>
            <select class="form-select" name="collectionSeason">
              <option value="Spring">Spring</option>
              <option value="Summer">Summer</option>
              <option value="Fall">Fall</option>
              <option value="Winter">Winter</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addBatchModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addBatchForm').requestSubmit()">Create Batch</button>
      </div>
    </div>
  </div>

  <!-- Add Shipment Modal -->
  <div id="addShipmentModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Track New Shipment</h3>
        <button class="modal-close" onclick="closeModal('addShipmentModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addShipmentForm" onsubmit="addShipment(event)">
          <div class="form-group">
            <label class="form-label">Order Number</label>
            <select class="form-select" name="orderNumber" id="shipmentOrderSelect" required></select>
          </div>
          <div class="form-group">
            <label class="form-label">Tracking Number</label>
            <input type="text" class="form-input" name="trackingNumber" required>
          </div>
          <div class="form-group">
            <label class="form-label">Carrier</label>
            <select class="form-select" name="carrier" required>
              <option value="UPS">UPS</option>
              <option value="FedEx">FedEx</option>
              <option value="USPS">USPS</option>
              <option value="DHL">DHL</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Shipping Cost ($)</label>
            <input type="number" class="form-input" name="shippingCost" step="0.01" value="25">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addShipmentModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addShipmentForm').requestSubmit()">Start Tracking</button>
      </div>
    </div>
  </div>

  <!-- Shipment Detail Modal -->
  <div id="shipmentDetailModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="shipmentDetailTitle">Shipment Details</h3>
        <button class="modal-close" onclick="closeModal('shipmentDetailModal')">√ó</button>
      </div>
      <div class="modal-body">
        <div id="shipmentDetailContent"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('shipmentDetailModal')">Close</button>
      </div>
    </div>
  </div>

  <!-- Add Order Modal -->
  <div id="addOrderModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">New Order</h3>
        <button class="modal-close" onclick="closeModal('addOrderModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addOrderForm" onsubmit="addOrder(event)">
          <div class="form-group">
            <label class="form-label">Customer Name</label>
            <input type="text" class="form-input" name="customer" required>
          </div>
          <div class="form-group">
            <label class="form-label">Items Description</label>
            <textarea class="form-textarea" name="items" required placeholder="e.g., 100x Orchid Stage III"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Total Value ($)</label>
            <input type="number" class="form-input" name="totalValue" step="0.01" required>
          </div>
          <div class="form-group">
            <label class="form-label">Deadline</label>
            <input type="date" class="form-input" name="deadline" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addOrderModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addOrderForm').requestSubmit()">Create Order</button>
      </div>
    </div>
  </div>

  <!-- Add Inventory Modal -->
  <div id="addInventoryModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Inventory Item</h3>
        <button class="modal-close" onclick="closeModal('addInventoryModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addInventoryForm" onsubmit="addInventoryItem(event)">
          <div class="form-group">
            <label class="form-label">Item Name</label>
            <input type="text" class="form-input" name="name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-select" name="category" required>
              <option value="Chemicals">Chemicals</option>
              <option value="Media Components">Media Components</option>
              <option value="Gelling Agents">Gelling Agents</option>
              <option value="Hormones">Hormones</option>
              <option value="Vessels">Vessels</option>
              <option value="PPE">PPE</option>
              <option value="Consumables">Consumables</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Current Stock</label>
            <input type="number" class="form-input" name="currentStock" required>
          </div>
          <div class="form-group">
            <label class="form-label">Reorder Level</label>
            <input type="number" class="form-input" name="reorderLevel" required>
          </div>
          <div class="form-group">
            <label class="form-label">Cost per Unit ($)</label>
            <input type="number" class="form-input" name="costPerUnit" step="0.01" required>
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" name="location" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addInventoryModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addInventoryForm').requestSubmit()">Add Item</button>
      </div>
    </div>
  </div>
  <!-- Add Expense Modal -->
  <div id="addExpenseModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Expense</h3>
        <button class="modal-close" onclick="closeModal('addExpenseModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addExpenseForm" onsubmit="addExpense(event)">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" name="date" required>
          </div>
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-select" name="category" required>
              <option value="Chemicals">Chemicals</option>
              <option value="Equipment">Equipment</option>
              <option value="Labor">Labor</option>
              <option value="Utilities">Utilities</option>
              <option value="Rent">Rent</option>
              <option value="Marketing">Marketing</option>
              <option value="Shipping">Shipping</option>
              <option value="Miscellaneous">Miscellaneous</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <input type="text" class="form-input" name="description" required>
          </div>
          <div class="form-group">
            <label class="form-label">Amount ($)</label>
            <input type="number" class="form-input" name="amount" step="0.01" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addExpenseModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addExpenseForm').requestSubmit()">Add Expense</button>
      </div>
    </div>
  </div>

  <!-- Add Income Modal -->
  <div id="addIncomeModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Income</h3>
        <button class="modal-close" onclick="closeModal('addIncomeModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addIncomeForm" onsubmit="addIncome(event)">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" name="date" required>
          </div>
          <div class="form-group">
            <label class="form-label">Source</label>
            <input type="text" class="form-input" name="source" required>
          </div>
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-select" name="category" required>
              <option value="Sales">Sales</option>
              <option value="Consulting">Consulting</option>
              <option value="Grant">Grant</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Amount ($)</label>
            <input type="number" class="form-input" name="amount" step="0.01" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addIncomeModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addIncomeForm').requestSubmit()">Add Income</button>
      </div>
    </div>
  </div>

  <!-- Add Environment Log Modal -->
  <div id="addEnvLogModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Log Environmental Data</h3>
        <button class="modal-close" onclick="closeModal('addEnvLogModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addEnvLogForm" onsubmit="addEnvLog(event)">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" name="date" required>
          </div>
          <div class="form-group">
            <label class="form-label">Temperature Morning (¬∞C)</label>
            <input type="number" class="form-input" name="tempMorning" step="0.1" required>
          </div>
          <div class="form-group">
            <label class="form-label">Temperature Evening (¬∞C)</label>
            <input type="number" class="form-input" name="tempEvening" step="0.1" required>
          </div>
          <div class="form-group">
            <label class="form-label">Humidity (%)</label>
            <input type="number" class="form-input" name="humidity" step="1" required>
          </div>
          <div class="form-group">
            <label class="form-label">Photoperiod (hours light/dark)</label>
            <input type="text" class="form-input" name="photoperiod" placeholder="16/8" required>
          </div>
          <div class="form-group">
            <label class="form-label">Light Intensity (lux)</label>
            <input type="number" class="form-input" name="lightIntensity" step="1">
          </div>
          <div class="form-group">
            <label class="form-label">Notes</label>
            <textarea class="form-textarea" name="notes"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addEnvLogModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addEnvLogForm').requestSubmit()">Save Log</button>
      </div>
    </div>
  </div>

  <!-- Add Task Modal -->
  <div id="addTaskModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">New Task</h3>
        <button class="modal-close" onclick="closeModal('addTaskModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addTaskForm" onsubmit="addTask(event)">
          <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-input" name="title" required>
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" name="description"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Priority</label>
            <select class="form-select" name="priority" required>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Due Date</label>
            <input type="date" class="form-input" name="dueDate" required>
          </div>
          <div class="form-group">
            <label class="form-label">Related To</label>
            <input type="text" class="form-input" name="relatedTo" placeholder="Batch ID, Order #, etc.">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addTaskModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addTaskForm').requestSubmit()">Create Task</button>
      </div>
    </div>
  </div>

  <!-- Add Media Recipe Modal -->
  <div id="addMediaRecipeModal" class="modal-overlay">
    <div class="modal" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title">New Media Recipe</h3>
        <button class="modal-close" onclick="closeModal('addMediaRecipeModal')">√ó</button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <form id="addMediaRecipeForm" onsubmit="addMediaRecipe(event)">
          <div class="form-group">
            <label class="form-label">Recipe Name</label>
            <input type="text" class="form-input" name="name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Base Medium</label>
            <select class="form-select" name="base" required>
              <option value="MS">MS (Murashige & Skoog)</option>
              <option value="WPM">WPM (Woody Plant Medium)</option>
              <option value="B5">B5 (Gamborg)</option>
              <option value="Custom">Custom</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Linked Stage</label>
            <select class="form-select" name="linkedStage">
              <option value="I">Stage I - Establishment</option>
              <option value="II">Stage II - Multiplication</option>
              <option value="III">Stage III - Rooting</option>
              <option value="IV">Stage IV - Acclimatization</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Carbon Source</label>
            <input type="text" class="form-input" name="carbonType" value="Sucrose" placeholder="Sucrose, Glucose">
          </div>
          <div class="form-group">
            <label class="form-label">Carbon Amount (g/L)</label>
            <input type="number" class="form-input" name="carbonAmount" value="30" step="0.1">
          </div>
          <div class="form-group">
            <label class="form-label">Gelling Agent</label>
            <input type="text" class="form-input" name="gellingType" value="Agar">
          </div>
          <div class="form-group">
            <label class="form-label">Gelling Agent Amount (g/L)</label>
            <input type="number" class="form-input" name="gellingAmount" value="7" step="0.1">
          </div>
          <div class="form-group">
            <label class="form-label">Target pH</label>
            <input type="number" class="form-input" name="pH" value="5.7" step="0.1" min="4" max="7">
          </div>
          <h4 style="margin: 24px 0 16px; font-size: 16px; font-weight: 600;">Plant Growth Regulators</h4>
          <div id="pgrInputs">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 100px; gap: 8px; margin-bottom: 8px;">
              <input type="text" class="form-input" placeholder="PGR Name (e.g., BAP)" name="pgrName0">
              <input type="number" class="form-input" placeholder="mg/L" name="pgrMgL0" step="0.01">
              <input type="number" class="form-input" placeholder="¬µM" name="pgrUM0" step="0.01">
              <select class="form-select" name="pgrType0">
                <option value="Cytokinin">Cytokinin</option>
                <option value="Auxin">Auxin</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          <button type="button" class="btn btn-secondary" onclick="addPGRInput()">+ Add PGR</button>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addMediaRecipeModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addMediaRecipeForm').requestSubmit()">Save Recipe</button>
      </div>
    </div>
  </div>

  <!-- Add Notebook Entry Modal -->
  <div id="addNotebookEntryModal" class="modal-overlay">
    <div class="modal" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title">New Laboratory Notebook Entry</h3>
        <button class="modal-close" onclick="closeModal('addNotebookEntryModal')">√ó</button>
      </div>
      <div class="modal-body">
        <div style="background: rgba(255, 159, 10, 0.1); padding: 16px; border-radius: 12px; margin-bottom: 16px; border: 1px solid var(--accent-orange);">
          <p style="font-size: 14px; color: var(--accent-orange);">
            ‚ö†Ô∏è <strong>IP Protection Enabled:</strong> This entry will be permanently logged with timestamp and cannot be deleted. Corrections must be noted as amendments.
          </p>
        </div>
        <form id="addNotebookForm" onsubmit="addNotebookEntry(event)">
          <div class="form-group">
            <label class="form-label">Entry Title</label>
            <input type="text" class="form-input" name="title" required>
          </div>
          <div class="form-group">
            <label class="form-label">Procedure/Observation</label>
            <textarea class="form-textarea" name="content" rows="6" required></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Related Batch/Experiment ID</label>
            <input type="text" class="form-input" name="relatedId">
          </div>
          <div class="form-group">
            <label class="form-label">Technician Name</label>
            <input type="text" class="form-input" name="technician" required>
          </div>
          <div class="form-group">
            <label class="form-label">Witness/Countersignature</label>
            <input type="text" class="form-input" name="witness" placeholder="Second person verification">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addNotebookEntryModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addNotebookForm').requestSubmit()">Submit Entry</button>
      </div>
    </div>
  </div>

  <!-- Add Contamination Modal -->
  <div id="addContaminationModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Log Contamination Incident</h3>
        <button class="modal-close" onclick="closeModal('addContaminationModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addContaminationForm" onsubmit="addContamination(event)">
          <div class="form-group">
            <label class="form-label">Detection Date</label>
            <input type="date" class="form-input" name="date" required>
          </div>
          <div class="form-group">
            <label class="form-label">Batch ID</label>
            <input type="text" class="form-input" name="batchId" required>
          </div>
          <div class="form-group">
            <label class="form-label">Contamination Type</label>
            <select class="form-select" name="type" required>
              <option value="Bacterial">Bacterial (Cloudy)</option>
              <option value="Fungal">Fungal (Fuzzy)</option>
              <option value="Unknown">Unknown</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Visual Description</label>
            <textarea class="form-textarea" name="description" required></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Suspected Cause</label>
            <select class="form-select" name="cause" required>
              <option value="Airborne">Airborne</option>
              <option value="Water">Water Source</option>
              <option value="Instrument">Instrument Contamination</option>
              <option value="Media">Media Preparation</option>
              <option value="Explant">Explant Source</option>
              <option value="Unknown">Unknown</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Action Taken</label>
            <select class="form-select" name="action" required>
              <option value="Discarded">Discarded</option>
              <option value="Salvaged">Attempted Salvage</option>
              <option value="Treated">Treated with Antibiotics</option>
              <option value="Isolated">Isolated for Observation</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addContaminationModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addContaminationForm').requestSubmit()">Log Incident</button>
      </div>
    </div>
  </div>

  <!-- Add Equipment Modal -->
  <div id="addEquipmentModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Equipment</h3>
        <button class="modal-close" onclick="closeModal('addEquipmentModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addEquipmentForm" onsubmit="addEquipment(event)">
          <div class="form-group">
            <label class="form-label">Equipment Name</label>
            <input type="text" class="form-input" name="name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Equipment Type</label>
            <select class="form-select" name="type" required>
              <option value="Balance">Balance</option>
              <option value="pH Meter">pH Meter</option>
              <option value="Autoclave">Autoclave</option>
              <option value="Laminar Flow Hood">Laminar Flow Hood</option>
              <option value="Refrigerator">Refrigerator</option>
              <option value="Freezer">Freezer</option>
              <option value="Microscope">Microscope</option>
              <option value="Stirrer">Magnetic Stirrer/Hot Plate</option>
              <option value="Water Purification">Water Purification System</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" name="location" required>
          </div>
          <div class="form-group">
            <label class="form-label">Last Maintenance Date</label>
            <input type="date" class="form-input" name="lastMaintenance">
          </div>
          <div class="form-group">
            <label class="form-label">Maintenance Interval (days)</label>
            <input type="number" class="form-input" name="maintenanceInterval" value="90">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addEquipmentModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addEquipmentForm').requestSubmit()">Add Equipment</button>
      </div>
    </div>
  </div>

  <!-- Add Autoclave Log Modal -->
  <div id="addAutoclaveModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Log Autoclave Cycle</h3>
        <button class="modal-close" onclick="closeModal('addAutoclaveModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addAutoclaveForm" onsubmit="addAutoclaveCycle(event)">
          <div class="form-group">
            <label class="form-label">Cycle Date/Time</label>
            <input type="datetime-local" class="form-input" name="datetime" required>
          </div>
          <div class="form-group">
            <label class="form-label">Duration (minutes)</label>
            <input type="number" class="form-input" name="duration" value="20" required>
          </div>
          <div class="form-group">
            <label class="form-label">Target Temperature (¬∞C)</label>
            <input type="number" class="form-input" name="targetTemp" value="121" required>
          </div>
          <div class="form-group">
            <label class="form-label">Actual Temperature (¬∞C)</label>
            <input type="number" class="form-input" name="actualTemp" value="121" step="0.1" required>
          </div>
          <div class="form-group">
            <label class="form-label">Target Pressure (psi)</label>
            <input type="number" class="form-input" name="targetPressure" value="15" required>
          </div>
          <div class="form-group">
            <label class="form-label">Actual Pressure (psi)</label>
            <input type="number" class="form-input" name="actualPressure" value="15" step="0.1" required>
          </div>
          <div class="form-group">
            <label class="form-label">Load Description</label>
            <textarea class="form-textarea" name="loadDescription" required placeholder="e.g., 10L media bottles, glassware"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Operator</label>
            <input type="text" class="form-input" name="operator" required>
          </div>
          <div class="form-group">
            <label class="form-label">Sterilization Indicator Result</label>
            <select class="form-select" name="result" required>
              <option value="Pass">Pass</option>
              <option value="Fail">Fail</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addAutoclaveModal')">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('addAutoclaveForm').requestSubmit()">Log Cycle</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>